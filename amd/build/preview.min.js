/**
 * Preview modal implementation.
 *
 * @copyright  2019 R.J. van Dongen <rogier@sebsoft.nl>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_coupon/preview",["jquery","core/str","core/notification"],(function($,Str,Notification){var encodeQueryParams=function(data){const ret=[];for(let d in data)ret.push(encodeURIComponent(d)+"="+encodeURIComponent(data[d]));return ret.join("&")},CouponPreview=function(clickselector,url){this.selector=clickselector,this.url=url,Str.get_string("preview-pdf","block_coupon").then(function(title){this.title=title,this.setupHandlers()}.bind(this)).fail(Notification.exception)};return CouponPreview.prototype.title=null,CouponPreview.prototype.url=null,CouponPreview.prototype.modal=null,CouponPreview.prototype.selector=null,CouponPreview.prototype.closeHandler=function(){this.destroy()},CouponPreview.prototype.clickOutHandler=function(e){$(e.target)==this.modal&&this.destroy()},CouponPreview.prototype.setupHandler=function(){var url=this.url,extraparams={},el=null;void 0!==(el=document.getElementById("id_font"))&&(extraparams.font=el.options[el.options.selectedIndex].text),void 0!==(el=document.getElementById("id_renderqrcode"))&&el.checked&&(extraparams.qr=1),Object.keys(extraparams).length&&(url.indexOf("?")>=0?url+="&"+encodeQueryParams(extraparams):url+="?"+encodeQueryParams(extraparams));var html='<div id="block-coupon-modal"><div class="block-coupon-modal-content">';html+='<div class="block-coupon-modal-header">',html+='<span id="block-modal-close" class="close">&times;</span>',html+="<h2>"+this.title+"</h2>",html+="</div>",html+='<div class="block-coupon-modal-body">',html+='<iframe src="'+url+'"></iframe>',html+="</div>",html+="</div></div>",this.modal=$(html),$("body").append(this.modal),this.modal.hide(),$("#block-modal-close").on("click",this.destroy.bind(this)),$("body").on("click",this.clickOutHandler.bind(this)),this.modal.show()},CouponPreview.prototype.setupHandlers=function(){$(this.selector).on("click",this.setupHandler.bind(this))},CouponPreview.prototype.destroy=function(){$("#block-modal-close").off("click"),$("body").off("click"),this.modal.hide(),this.modal.remove()},{init:function(clickselector,url){new CouponPreview(clickselector,url)}}}));

//# sourceMappingURL=preview.min.js.map