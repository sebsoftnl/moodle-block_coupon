{"version":3,"file":"editlog.min.js","sources":["../../src/editlog/editlog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery';\nimport * as Str from 'core/str';\nimport * as DynamicTable from 'core_table/dynamic';\nimport ModalForm from 'core_form/modalform';\nimport {add as addToast} from 'core/toast';\n\nconst revertProc = (e) => {\n    e.preventDefault();\n\n    let mfArgs = {\n        procid: e.currentTarget.dataset.procid\n    };\n    if (e.currentTarget.dataset.jArgs !== undefined) {\n        let jArgs = e.currentTarget.dataset.jArgs;\n        if (typeof jArgs === 'string') {\n            jArgs = JSON.parse(jArgs);\n        }\n        for (const [key, value] of Object.entries(jArgs)) {\n            mfArgs[key] = value;\n        }\n    }\n\n    const revertType = e.currentTarget.dataset.type;\n    let formClass = '', title = '';\n    if (revertType === 'course') {\n        formClass = 'block_coupon\\\\forms\\\\dynamic\\\\revertcoursemod';\n        title = Str.get_string('revertcoursemod', 'block_coupon');\n    } else if (revertType === 'cohort') {\n        formClass = 'block_coupon\\\\forms\\\\dynamic\\\\revertcohortmod';\n        title = Str.get_string('revertcohortmod', 'block_coupon');\n    }\n\n    const modalForm = new ModalForm({\n        formClass,\n        modalConfig: {title},\n        args: mfArgs,\n        returnFocus: e.target\n    });\n\n\n    // When table ID not provided, detect.\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (result) => {\n        if (result.detail.result) {\n            let dt = e.currentTarget.closest('.table-dynamic');\n            if (dt.dataset.tableUniqueid !== undefined) {\n                DynamicTable.refreshTableContent(DynamicTable.getTableFromId(dt.dataset.tableUniqueid));\n            }\n            if (result.detail.notifications.length > 0) {\n                result.detail.notifications.forEach( m => addToast(m.msg, {type:m.type}) );\n            }\n        }\n    });\n    modalForm.show();\n};\n\nconst revertMod = (e) => {\n    e.preventDefault();\n\n    let mfArgs = {\n        modid: e.currentTarget.dataset.modid\n    };\n    if (e.currentTarget.dataset.jArgs !== undefined) {\n        let jArgs = e.currentTarget.dataset.jArgs;\n        if (typeof jArgs === 'string') {\n            jArgs = JSON.parse(jArgs);\n        }\n        for (const [key, value] of Object.entries(jArgs)) {\n            mfArgs[key] = value;\n        }\n    }\n\n    const revertType = e.currentTarget.dataset.type;\n    let formClass = '', title = '';\n    if (revertType === 'course') {\n        formClass = 'block_coupon\\\\forms\\\\dynamic\\\\revertcoursemod';\n        title = Str.get_string('revertcoursemod', 'block_coupon');\n    } else if (revertType === 'cohort') {\n        formClass = 'block_coupon\\\\forms\\\\dynamic\\\\revertcohortmod';\n        title = Str.get_string('revertcohortmod', 'block_coupon');\n    }\n\n    const modalForm = new ModalForm({\n        formClass,\n        modalConfig: {title},\n        args: mfArgs,\n        returnFocus: e.target\n    });\n\n    // When table ID not provided, detect.\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (result) => {\n        if (result.detail.result) {\n            let dt = e.currentTarget.closest('.table-dynamic');\n            if (dt.dataset.tableUniqueid !== undefined) {\n                DynamicTable.refreshTableContent(DynamicTable.getTableFromId(dt.dataset.tableUniqueid));\n            }\n            if (result.detail.notifications.length > 0) {\n                result.detail.notifications.forEach( m => addToast(m.msg, {type:m.type}) );\n            }\n        }\n    });\n    modalForm.show();\n};\n\nexport default {\n    init: (selector) => {\n        $(selector).on('click', '[data-action=\"revertproc\"]', revertProc);\n        $(selector).on('click', '[data-action=\"revertmod\"]', revertMod);\n    }\n};\n"],"names":["revertProc","e","preventDefault","mfArgs","procid","currentTarget","dataset","undefined","jArgs","JSON","parse","key","value","Object","entries","revertType","type","formClass","title","Str","get_string","modalForm","ModalForm","modalConfig","args","returnFocus","target","addEventListener","events","FORM_SUBMITTED","result","detail","dt","closest","tableUniqueid","DynamicTable","refreshTableContent","getTableFromId","notifications","length","forEach","m","msg","show","revertMod","modid","init","selector","on"],"mappings":"s8CAqBMA,WAAcC,IAChBA,EAAEC,qBAEEC,OAAS,CACTC,OAAQH,EAAEI,cAAcC,QAAQF,gBAEEG,IAAlCN,EAAEI,cAAcC,QAAQE,MAAqB,KACzCA,MAAQP,EAAEI,cAAcC,QAAQE,MACf,iBAAVA,QACPA,MAAQC,KAAKC,MAAMF,YAElB,MAAOG,IAAKC,SAAUC,OAAOC,QAAQN,OACtCL,OAAOQ,KAAOC,YAIhBG,WAAad,EAAEI,cAAcC,QAAQU,SACvCC,UAAY,GAAIC,MAAQ,GACT,WAAfH,YACAE,UAAY,gDACZC,MAAQC,IAAIC,WAAW,kBAAmB,iBACpB,WAAfL,aACPE,UAAY,gDACZC,MAAQC,IAAIC,WAAW,kBAAmB,uBAGxCC,UAAY,IAAIC,mBAAU,CAC5BL,UAAAA,UACAM,YAAa,CAACL,MAAAA,OACdM,KAAMrB,OACNsB,YAAaxB,EAAEyB,SAKnBL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAiBC,YACrDA,OAAOC,OAAOD,OAAQ,KAClBE,GAAK/B,EAAEI,cAAc4B,QAAQ,uBACA1B,IAA7ByB,GAAG1B,QAAQ4B,eACXC,aAAaC,oBAAoBD,aAAaE,eAAeL,GAAG1B,QAAQ4B,gBAExEJ,OAAOC,OAAOO,cAAcC,OAAS,GACrCT,OAAOC,OAAOO,cAAcE,SAASC,IAAK,cAASA,EAAEC,IAAK,CAAC1B,KAAKyB,EAAEzB,aAI9EK,UAAUsB,QAGRC,UAAa3C,IACfA,EAAEC,qBAEEC,OAAS,CACT0C,MAAO5C,EAAEI,cAAcC,QAAQuC,eAEGtC,IAAlCN,EAAEI,cAAcC,QAAQE,MAAqB,KACzCA,MAAQP,EAAEI,cAAcC,QAAQE,MACf,iBAAVA,QACPA,MAAQC,KAAKC,MAAMF,YAElB,MAAOG,IAAKC,SAAUC,OAAOC,QAAQN,OACtCL,OAAOQ,KAAOC,YAIhBG,WAAad,EAAEI,cAAcC,QAAQU,SACvCC,UAAY,GAAIC,MAAQ,GACT,WAAfH,YACAE,UAAY,gDACZC,MAAQC,IAAIC,WAAW,kBAAmB,iBACpB,WAAfL,aACPE,UAAY,gDACZC,MAAQC,IAAIC,WAAW,kBAAmB,uBAGxCC,UAAY,IAAIC,mBAAU,CAC5BL,UAAAA,UACAM,YAAa,CAACL,MAAAA,OACdM,KAAMrB,OACNsB,YAAaxB,EAAEyB,SAInBL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAiBC,YACrDA,OAAOC,OAAOD,OAAQ,KAClBE,GAAK/B,EAAEI,cAAc4B,QAAQ,uBACA1B,IAA7ByB,GAAG1B,QAAQ4B,eACXC,aAAaC,oBAAoBD,aAAaE,eAAeL,GAAG1B,QAAQ4B,gBAExEJ,OAAOC,OAAOO,cAAcC,OAAS,GACrCT,OAAOC,OAAOO,cAAcE,SAASC,IAAK,cAASA,EAAEC,IAAK,CAAC1B,KAAKyB,EAAEzB,aAI9EK,UAAUsB,qBAGC,CACXG,KAAOC,+BACDA,UAAUC,GAAG,QAAS,6BAA8BhD,gCACpD+C,UAAUC,GAAG,QAAS,4BAA6BJ"}